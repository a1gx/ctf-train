#!/usr/bin/python
#coding=utf-8
from PwnContext import *
from IPython import embed as ipy

context.terminal = ['gnome-terminal','-x','sh','-c']


s       = lambda data               :ctx.send(str(data))
sa      = lambda delim,data         :ctx.sendafter(str(delim), str(data)) 
sl      = lambda data               :ctx.sendline(str(data)) 
sla     = lambda delim,data         :ctx.sendlineafter(str(delim), str(data)) 
r       = lambda numb=4096          :ctx.recv(numb)
ru      = lambda delims, drop=False  :ctx.recvuntil(delims, drop)
irt     = lambda                    :ctx.interactive()
rs      = lambda *args, **kwargs    :ctx.start(*args, **kwargs)
dbg     = lambda gs='', **kwargs    :ctx.debug(gdbscript=gs, **kwargs)

uu32    = lambda data   :u32(data.ljust(4, '\x00'))
uu64    = lambda data   :u64(data.ljust(8, '\x00'))
leak    = lambda name,addr :log.success('{} = {:#x}'.format(name, addr))
def lg(s,addr):
    print '\033[1;31;40m%20s-->0x%x\033[0m'%(s,addr)

# context.log_level = 'debug'
ctx.binary = './note'
# ctx.remote = ('1.1.1.1', 1111)
ctx.custom_lib_dir = './lib'
ctx.debug_remote_libc = True
ctx.symbols = {'heap_base':0x2280,'note':0x202040}
ctx.breakpoints = [0xd7a] 

heap = ['' for _ in range(0x100)]

def menu(num):
	sla('Choice: ',str(num))
def add(idx,num,content):
	menu(1)
	for i in range(0x100):
		if not heap[i]:
			heap[i]=str(idx)
			break
	sla('Size: ',str(num))
	sa('Content: ',content)
def show(num):
	menu(3)
	sla('Idx: ',str(num))
def remove(num):
	menu(2)
	sla('Idx: ',str(num))
	heap[num]=''
def pheap():
	for i in range(0x100):
		if heap[i]:
			print str(i)+'-->'+heap[i]+'号堆'
func = []
rs()
libc = ctx.libc
# libc2.29除了unlink还新增了一个检测机制chunksize(p)==presize
# off buy null 是要构造3个堆！！！